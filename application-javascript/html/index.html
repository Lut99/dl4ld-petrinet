<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>

        <title>Petri Nets</title>

        <link rel="stylesheet" type="text/css" href="/html/joint.min.css" />
	<link rel="stylesheet" href="html/styles/w3.css">

    </head>
    <body>
	<div class="w3-sidebar w3-bar-block" style="width:15%">
	  <a href="#" class="w3-bar-item w3-button">Organizations</a>
	  <a href="#" class="w3-bar-item w3-button">Places</a>
	  <a href="#" class="w3-bar-item w3-button">Transitions</a>
	  <a href="#" class="w3-bar-item w3-button">Tokens</a>
	</div>
	<div style="margin-left:15%">
		<div id="paper"></div>
	</div>

	<script src="/socket.io/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fake-smile@1.0.1/smil.user.min.js"></script>
        <script src="/node_modules/jquery/dist/jquery.js"></script>
        <script src="/node_modules/lodash/lodash.js"></script>
        <script src="/node_modules/backbone/backbone.js"></script>

        <script src="/html/joint.min.js"></script>
        <script src="/html/pn.js"></script>

	<script> 
	
	  const db = {
		  orgs: {},
		  nets: {},
		  places: {},
		  tokens: {},
		  transitions: {}
	  }

	  $.when( $.ready ).then(function() {

		// open web socket
                socket = io()
                socket.emit('ready', '');

		socket.on('tokens', function(data) {
                	console.log("tokens> ", data);
			const tokens = JSON.parse(data);
			tokens.map(function(t){ return t.Record;})
				.forEach(function(t){
					db.tokens[t.id] = t;
				})

		})
		socket.on('places', function(data) {
                	console.log("places> ", data);
			const places = JSON.parse(data);
			places.map(function(p) {
				return p.Record;
				})
				.forEach(function(p){
					db.places[p.id] = p;
				})

		})
		socket.on('transitions', function(data) {
                	console.log("transitions> ", data);
			const transitions = JSON.parse(data);
			transitions.map(function(t) { return t.Record; })
				.forEach(function(t) {
					db.transitions[t.id] = t;
				})
		})

                socket.on('net', function(data) {
                        console.log("nets> ", data);
			const nets = JSON.parse(data);
			nets.map(function(n) { return n.Record; })
				.forEach(function(n) {
					db.nets[n.id] = n;
				})
                })
		setTimeout(function() { console.log(db)}, 5000)

	  });

	</script>

</body>
</html>
